<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Discord User Character Form</title>
  <style>
    /* Overall Discord Dark Theme */
    body {
      background-color: #36393f;
      color: #dcddde;
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    #container {
      text-align: center;
      width: 100%;
      max-width: 500px;
    }

    /* Login Button Styling */
    button {
      background-color: #5865F2;
      color: #fff;
      border: none;
      padding: 12px 20px;
      font-size: 1rem;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    button:hover {
      background-color: #4752c4;
    }

    button:active {
      background-color: #3c43a1;
    }

    /* Form Container Styling */
    #formContainer {
      display: none;
      background-color: #2f3136;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      margin-top: 20px;
      text-align: left;
    }

    .form-field {
      margin-bottom: 15px;
    }

    .form-field label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    .form-field input[type="text"],
    .form-field input[type="number"],
    .form-field select {
      width: 100%;
      padding: 8px;
      border: 1px solid #202225;
      border-radius: 3px;
      background-color: #40444b;
      color: #dcddde;
    }

    .radio-group {
      display: flex;
      gap: 20px;
      align-items: center;
    }

    .radio-group input[type="radio"] {
      margin-right: 5px;
    }

    /* Tooltip styling */
    .tooltip-container {
      position: relative;
      display: inline-block;
    }

    .tooltip-button {
      background-color: #5865F2;
      border: none;
      color: #fff;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 14px;
      cursor: default;
      padding: 0;
      margin-left: 5px;
      line-height: 20px;
      text-align: center;
    }

    .tooltip-text {
      visibility: hidden;
      width: 200px;
      background-color: #2f3136;
      color: #dcddde;
      text-align: center;
      border-radius: 5px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: 125%; /* Position above the button */
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.2s;
      pointer-events: none;
    }

    .tooltip-container:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }
  </style>
  <script>
    window.onload = function() {
      // Parse URL parameters for the access token
      const urlParams = new URLSearchParams(window.location.search);
      const accessToken = urlParams.get('code');

      if (!accessToken) {
        // Show login button if token isn't present
        document.getElementById('loginButton').style.display = 'block';
        return;
      }

      // Use the access token to fetch user information from Discord
      fetch('https://discord.com/api/users/@me', {
        headers: {
          'Authorization': `Bearer ${accessToken}`
        }
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(userData => {
        // Hide login button and message
        document.getElementById('loginButton').style.display = 'none';
        document.getElementById('message').style.display = 'none';
        // Fill the non-editable Discord field with the fetched username
        document.getElementById('discordUsername').value = userData.username;
        // Set the hidden access token field
        document.getElementById('accessTokenField').value = accessToken;
        // Display the form container
        document.getElementById('formContainer').style.display = 'block';
      })
      .catch(error => {
        console.error('Error:', error);
        document.getElementById('message').innerText = `Failed to retrieve user information`;
      });
    };

    function redirectToDiscordAuth() {
      window.location.href = 'https://discord.com/oauth2/authorize?client_id=712607067420229685&response_type=code&redirect_uri=https%3A%2F%2Fkn-discord.azurewebsites.net%2Fapi%2Fcallback&scope=identify';
    }
    
    // Optional: Handle form submission
    function handleFormSubmit(e) {
      e.preventDefault();
      // Here you can collect form data and send it as needed.
      const formData = new FormData(e.target);
      console.log(Object.fromEntries(formData)); // For demonstration
      alert('Form submitted!');
      // You can add your form submission logic (e.g., AJAX POST) here.
    }
  </script>
</head>
<body>
  <div id="container">
    <p id="message">Please log in with Discord.</p>
    <button id="loginButton" style="display:none;" onclick="redirectToDiscordAuth()">Login with Discord</button>

    <!-- Character Form -->
    <div id="formContainer">
      <form id="characterForm" onsubmit="handleFormSubmit(event)">
        <!-- Hidden field for the access token -->
        <input type="hidden" id="accessTokenField" name="accessToken" value="">

        <div class="form-field">
          <label for="characterName">Imię Postaci:</label>
          <input type="text" id="characterName" name="characterName" required>
        </div>
        <div class="form-field">
          <label for="gameLogin">Login w grze:</label>
          <input type="text" id="gameLogin" name="gameLogin" required>
        </div>
        <div class="form-field">
          <label for="discordUsername">Discord:</label>
          <input type="text" id="discordUsername" name="discordUsername" readonly>
        </div>
        <div class="form-field">
          <label for="characterClass">
            Klasy Postaci:
            <span class="tooltip-container">
              <button type="button" class="tooltip-button">?</button>
              <span class="tooltip-text">Planowane klasy postaci.</span>
            </span>
          </label>
          <input type="text" id="characterClass" name="characterClass" required>
        </div>
        <div class="form-field">
          <label>Płeć postaci:</label>
          <div class="radio-group">
            <label for="genderFemale">
              <input type="radio" id="genderFemale" name="characterGender" value="Kobieta" required> Kobieta
            </label>
            <label for="genderMale">
              <input type="radio" id="genderMale" name="characterGender" value="Mężczyzna" required> Mężczyzna
            </label>
          </div>
        </div>
        <div class="form-field">
          <label for="characterRace">Rasa postaci:</label>
          <input type="text" id="characterRace" name="characterRace" required>
        </div>
        <div class="form-field">
          <label for="characterAge">Wiek postaci:</label>
          <input type="number" id="characterAge" name="characterAge" min="18" required>
        </div>
        <div class="form-field">
          <label for="characterReligion">Wyznanie postaci:</label>
          <input type="text" id="characterReligion" name="characterReligion" required>
        </div>
        <div class="form-field">
          <label for="characterOrigin">
            Pochodzenie postaci:
            <span class="tooltip-container">
              <button type="button" class="tooltip-button">?</button>
              <span class="tooltip-text">Region lub miasto, np. Waterdeep</span>
            </span>
          </label>
          <input type="text" id="characterOrigin" name="characterOrigin" required>
        </div>
        <div class="form-field">
          <label for="characterPersonality">Charakter:</label>
          <select id="characterPersonality" name="characterPersonality" required>
            <option value="">Wybierz charakter</option>
            <option value="Praworządny Dobry">Praworządny Dobry</option>
            <option value="Neutralny Dobry">Neutralny Dobry</option>
            <option value="Chaotyczny Dobry">Chaotyczny Dobry</option>
            <option value="Praworządny Neutralny">Praworządny Neutralny</option>
            <option value="Prawdziwie Neutralny">Prawdziwie Neutralny</option>
            <option value="Chaotyczny Neutralny">Chaotyczny Neutralny</option>
            <option value="Praworządny Zły">Praworządny Zły</option>
            <option value="Neutralny Zły">Neutralny Zły</option>
            <option value="Chaotyczny Zły">Chaotyczny Zły</option>
          </select>
        </div>
        <div class="form-field">
          <label for="characterLanguages">
            Znane języki:
            <span class="tooltip-container">
              <button type="button" class="tooltip-button">?</button>
              <span class="tooltip-text">Nie musisz pisać, że krasnolud zna język krasonludzki. Czy postać zna jakieś niestandardowe języki? Nie zapomnij podać uzasadnienia!</span>
            </span>
          </label>
          <input type="text" id="characterLanguages" name="characterLanguages">
        </div>
        <button type="submit">Wyślij</button>
      </form>
    </div>
  </div>
</body>
</html>
